<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>أداة التصميم والتخطيط الذكي للمنشآت – النظام المتطور</title>
  <!-- أيقونات Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <!-- خط "Cairo" -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" />
  <!-- مكتبة AOS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
  <!-- مكتبة Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- مكتبة jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- مكتبة SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- مكتبة Three.js و OrbitControls -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/controls/OrbitControls.js"></script>
  <!-- مكتبة SortableJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <!-- مكتبة Frappe Gantt -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.5.0/frappe-gantt.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.5.0/frappe-gantt.min.js"></script>
  <style>
    /* إعدادات الخطوط والألوان الأساسية باستخدام CSS Variables */
    :root {
      --primary-color: #8B4513;
      --secondary-color: #1abc9c;
      --accent-color: #FFD700;
      --text-color: #333;
      --bg-gradient: linear-gradient(45deg, #654321, #8B4513, #A0522D);
      --font-size: 16px;
      --font-family: 'Cairo', sans-serif;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      scroll-behavior: smooth;
    }
    body {
      font-family: var(--font-family);
      font-size: var(--font-size);
      background: var(--bg-gradient);
      background-size: 400% 400%;
      min-height: 100vh;
      direction: rtl;
      color: var(--text-color);
      transition: background 0.5s, color 0.5s, font-size 0.3s;
    }
    body.light-mode {
      --primary-color: #4a4a4a;
      --secondary-color: #3498db;
      --accent-color: #e67e22;
      --text-color: #333;
      --bg-gradient: linear-gradient(45deg, #f0f0f0, #fff);
      background: var(--bg-gradient);
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* تحسين الهيدر */
    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--primary-color);
      padding: 10px 20px;
      color: #fff;
      position: sticky;
      top: 0;
      z-index: 2200;
    }
    /* الشعار: نص متحرك في المنتصف */
    .logo {
      font-size: 2.5em;
      font-weight: bold;
      letter-spacing: 3px;
      cursor: pointer;
      animation: rotateLogoLR 5s linear infinite;
    }
    /* دوران من اليسار إلى اليمين */
    @keyframes rotateLogoLR {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(360deg); }
    }
    /* عرض الوقت والتاريخ تحت الشعار */
    .date-time {
      font-size: 1em;
      margin-top: 5px;
      font-weight: bold;
    }
    /* قائمة التنقل */
    nav {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 10px;
    }
    nav .nav-buttons button {
      background: var(--secondary-color);
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    nav .nav-buttons button:hover {
      background: var(--accent-color);
      transform: scale(1.05);
    }
    /* شاشة التحميل */
    .loader {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg-gradient);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 3000;
    }
    .loader::after {
      content: "";
      width: 50px;
      height: 50px;
      border: 5px solid var(--secondary-color);
      border-top-color: var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    /* الحاوية الرئيسية */
    .container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 30px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      direction: rtl;
    }
    h1#mainTitle {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 20px;
      font-size: 2.5em;
    }
    h2 {
      color: var(--primary-color);
      margin-bottom: 10px;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
      font-size: 1.8em;
    }
    /* باقي التنسيقات العامة */
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: var(--font-size);
    }
    button {
      background-color: var(--primary-color);
      color: #fff;
      cursor: pointer;
      border: none;
      transition: background 0.3s, transform 0.3s;
    }
    button:hover { background-color: var(--accent-color); transform: scale(1.02); }
    .section {
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    .export-buttons { margin-top: 20px; text-align: center; }
    .export-buttons button { margin: 5px; }
    .reset-button { background-color: #d9534f; margin-bottom: 20px; }
    .reset-button:hover { background-color: #c9302c; }
    /* قسم إعدادات النظام */
    .settings-section {
      background-color: #fff3e0;
      border: 1px solid #ffcc80;
      border-radius: 8px;
      padding: 20px;
    }
    .settings-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .settings-section label { margin-top: 10px; }
    .settings-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .settings-buttons button {
      flex: 1;
      padding: 8px;
      background: var(--secondary-color);
    }
    /* قسم تقدير الكميات والتكلفة */
    .estimation-section {
      background-color: #e8eaf6;
      border: 1px solid #c5cae9;
      border-radius: 8px;
      padding: 20px;
    }
    .estimation-section h2 {
      font-size: 1.8em;
      color: var(--primary-color);
      margin-bottom: 10px;
    }
    .estimation-section input, .estimation-section button {
      width: auto;
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .schedule-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .schedule-table th, .schedule-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .schedule-table th { background-color: var(--primary-color); color: #fff; }
    /* قسم التحليل المالي */
    .financial-analysis-section {
      background-color: #f9fbe7;
      border: 1px solid #dcedc8;
      border-radius: 8px;
      padding: 20px;
    }
    .financial-analysis-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .financial-analysis-section input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .financial-analysis-section button { max-width: 150px; }
    /* قسم محادثة الذكاء الاصطناعي (ChatGPT) */
    .external-ai-section {
      background-color: #fff3e0;
      border: 1px solid #ffcc80;
      border-radius: 8px;
      padding: 20px;
    }
    .external-ai-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .external-ai-section div {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }
    .external-ai-section input { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    .external-ai-section button { max-width: 150px; }
    /* قسم أدوات التحليل الهندسي */
    .engineering-tools-section {
      background-color: #f3e5f5;
      border: 1px solid #e1bee7;
      border-radius: 8px;
      padding: 20px;
    }
    .engineering-tools-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .engineering-tool-group { margin-bottom: 20px; }
    .engineering-tool-group label { font-size: 14px; margin-bottom: 5px; }
    .engineering-tool-group input { width: 100%; padding: 8px; margin-bottom: 5px; font-size: 14px; }
    .engineering-tool-group button { max-width: 150px; }
    .engineering-tool-group.stress-group {
      border-top: 1px dashed #ccc;
      padding-top: 10px;
    }
    /* قسم تحليل الموقع */
    .location-analysis-section {
      background-color: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 8px;
      padding: 20px;
    }
    .location-analysis-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .location-analysis-section input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
    .location-analysis-section button { max-width: 150px; }
    .location-analysis-section iframe {
      width: 100%;
      height: 300px;
      border: none;
      border-radius: 4px;
      margin-top: 10px;
    }
    /* قسم منصات التصميم والتخطيط */
    .platforms-section {
      background-color: #f0f4c3;
      border: 1px solid #dce775;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    .platforms-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .platforms-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .platforms-buttons a {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: var(--secondary-color);
      color: #fff;
      padding: 8px 12px;
      border-radius: 4px;
      text-decoration: none;
      transition: transform 0.3s, background 0.3s;
    }
    .platforms-buttons a:hover {
      background: var(--accent-color);
      transform: scale(1.05);
    }
    /* قسم المخطط الزمني (Gantt Chart) */
    .gantt-section {
      background-color: #e8f5e9;
      border: 1px solid #c8e6c9;
      border-radius: 8px;
      padding: 20px;
    }
    .gantt-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    #ganttChart { overflow-x: auto; }
    /* قسم التعليقات */
    .comments-section {
      background-color: #f1f8e9;
      border: 1px solid #dcedc8;
      border-radius: 8px;
      padding: 20px;
    }
    .comments-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .comments-section textarea {
      width: 100%;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    .comments-list { margin-top: 15px; list-style: none; padding: 0; }
    .comments-list li { padding: 10px; border-bottom: 1px solid #ccc; }
    /* قسم رفع الملفات */
    .file-upload-section {
      background-color: #ede7f6;
      border: 1px solid #d1c4e9;
      border-radius: 8px;
      padding: 20px;
    }
    .file-upload-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .file-upload-section input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    /* قسم إحصائيات المشروع (Line Chart) */
    .dashboard-section {
      background-color: #fffde7;
      border: 1px solid #fff9c4;
      border-radius: 8px;
      padding: 20px;
    }
    .dashboard-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .dashboard-stats { display: flex; flex-wrap: wrap; gap: 20px; }
    .stat-card {
      flex: 1 1 200px;
      background: var(--secondary-color);
      color: #fff;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    /* أقسام دليل المستخدم والمعايير والأدوات */
    .info-section {
      background-color: #f7f7f7;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 40px;
    }
    .info-section h2 { color: var(--primary-color); margin-bottom: 10px; }
    .info-section p, .info-section ul { color: #555; line-height: 1.6; }
    .info-section ul { list-style: disc; margin-right: 20px; }
    
    /* Media Queries */
    @media (max-width: 768px) {
      .container { margin: 15px; padding: 15px; }
      h1#mainTitle { font-size: 2em; }
      h2 { font-size: 1.5em; }
      #view2DContainer, #view3DContainer { height: 300px; }
      .platforms-buttons a { flex: 1 1 100px; font-size: 14px; }
    }
    @media (max-width: 480px) {
      body { font-size: 14px; }
      nav .nav-buttons button { padding: 6px 12px; }
      .design-grid { grid-template-columns: 1fr; }
      .export-buttons button { width: 100%; margin: 5px 0; }
    }
  </style>
</head>
<body>
  <!-- شاشة التحميل -->
  <div id="loader" class="loader"></div>
  
  <!-- الهيدر مع الشعار والوقت والتاريخ -->
  <header>
    <div class="logo" title="GUYC">GUYC</div>
    <div class="date-time" id="dateTimeDisplay"></div>
    <nav>
      <div id="navTitle"><strong data-key="navTitle">نظام التصميم الذكي</strong></div>
      <div class="nav-buttons">
        <button id="darkModeToggle" onclick="toggleDarkMode()">تبديل الوضع</button>
        <button id="langToggle" onclick="toggleLanguage()">EN/AR</button>
      </div>
    </nav>
  </header>
  
  <div class="container">
    <!-- لوحة المعلومات (Dashboard) -->
    <div class="section dashboard-section" id="dashboardSection" data-aos="fade-up">
      <h2>لوحة المعلومات</h2>
      <div class="dashboard-stats">
        <div class="stat-card" id="totalCostStat">التكلفة الإجمالية: 0</div>
        <div class="stat-card" id="totalTasksStat">عدد المهام: 0</div>
        <div class="stat-card" id="materialsCountStat">عدد المواد: 0</div>
        <div class="stat-card" id="progressStat">نسبة الإنجاز: 0%</div>
      </div>
    </div>
    
    <h1 id="mainTitle" data-key="mainTitle">أداة التصميم والتخطيط الذكي للمنشآت – النظام المتطور</h1>
    <p style="text-align: center; color: #555;">
      نظام شامل لتوليد مخطط بناء أولي ذكي وفق أعلى المعايير العالمية مع دعم 2D و3D وتحليل السيناريوهات والتكلفة.
    </p>
    
    <!-- قسم إعدادات النظام مع أزرار لتغيير اللغة والوضع -->
    <div class="section settings-section" id="settingsSection" data-aos="fade-up">
      <h2>إعدادات النظام</h2>
      <label for="primaryColorInput">اللون الأساسي:</label>
      <input type="color" id="primaryColorInput" value="#8B4513">
      <label for="secondaryColorInput">اللون الثانوي:</label>
      <input type="color" id="secondaryColorInput" value="#1abc9c">
      <label for="accentColorInput">اللون اللمسي:</label>
      <input type="color" id="accentColorInput" value="#FFD700">
      <label for="fontSizeInput">حجم الخط (px):</label>
      <input type="number" id="fontSizeInput" value="16">
      <label for="fontFamilySelect">نوع الخط:</label>
      <select id="fontFamilySelect">
        <option value="'Cairo', sans-serif" selected>Cairo</option>
        <option value="'Roboto', sans-serif">Roboto</option>
        <option value="'Open Sans', sans-serif">Open Sans</option>
        <option value="'Lato', sans-serif">Lato</option>
      </select>
      <div class="settings-buttons">
        <button onclick="toggleDarkMode()">تبديل الوضع</button>
        <button onclick="toggleLanguage()">تغيير اللغة</button>
      </div>
      <button onclick="applySettings()" class="btn-animate">تطبيق الإعدادات</button>
    </div>
    
    <!-- قسم معطيات المشروع -->
    <div class="section" id="dataSection" data-aos="fade-up">
      <h2 id="projectDataTitle" data-key="projectDataTitle">معطيات المشروع</h2>
      <p style="color: #555; font-size: 1.1em;">
        أدخل المعلومات الأساسية للمشروع: اسم المشروع، مساحة الأرض، مساحة البناء، عدد الأدوار، غرف النوم، الحمامات، المطابخ، وغرف المعيشة؛ مع تحديد تقسيم الأرض واتجاه المبنى والنمط التصميمي.
      </p>
      <label for="projectName" title="مثال: مشروع إنشاء فيلا سكنية">اسم المشروع:</label>
      <input type="text" id="projectName" placeholder="أدخل اسم المشروع">
      
      <label for="projectArea" title="أدخل مساحة الأرض بالمتر المربع">مساحة الأرض (م²):</label>
      <input type="number" id="projectArea" placeholder="أدخل مساحة الأرض">
      
      <label for="buildingArea" title="أدخل المساحة التي سيتم بناء المبنى عليها (م²)">مساحة البناء (م²):</label>
      <input type="number" id="buildingArea" placeholder="أدخل مساحة البناء">
      
      <label for="numFloors" title="أدخل عدد الأدوار المطلوبة">عدد الأدوار:</label>
      <input type="number" id="numFloors" placeholder="أدخل عدد الأدوار">
      
      <label for="numRooms" title="أدخل عدد غرف النوم">عدد غرف النوم:</label>
      <input type="number" id="numRooms" placeholder="أدخل عدد غرف النوم">
      
      <label for="numBathrooms" title="أدخل عدد الحمامات">عدد الحمامات:</label>
      <input type="number" id="numBathrooms" placeholder="أدخل عدد الحمامات">
      
      <label for="numKitchens" title="أدخل عدد المطابخ">عدد المطابخ:</label>
      <input type="number" id="numKitchens" placeholder="أدخل عدد المطابخ">
      
      <label for="numLivingRooms" title="أدخل عدد غرف المعيشة">عدد غرف المعيشة:</label>
      <input type="number" id="numLivingRooms" placeholder="أدخل عدد غرف المعيشة">
      
      <label for="landDivision" title="أدخل تفاصيل تقسيم الأرض">تفاصيل تقسيم الأرض:</label>
      <input type="text" id="landDivision" placeholder="مثلاً: 60% مبنى، 20% حديقة، 10% كراج، 10% مدخل">
      
      <label for="buildingOrientation" title="اختر الاتجاه الرئيسي للمبنى">اتجاه المبنى:</label>
      <select id="buildingOrientation">
        <option value="north">شمال</option>
        <option value="south">جنوب</option>
        <option value="east">شرق</option>
        <option value="west">غرب</option>
      </select>
      
      <label for="designStyle" title="اختر النمط التصميمي المطلوب">النمط التصميمي:</label>
      <select id="designStyle">
        <option value="european">أوروبي</option>
        <option value="american">أمريكي</option>
        <option value="asian">آسيوي</option>
        <option value="eastern">شرقي</option>
        <option value="modern">حديث</option>
        <option value="traditional">تقليدي</option>
      </select>
      
      <label for="totalCost" title="أدخل التكلفة الإجمالية للمشروع (اختياري)">التكلفة الإجمالية للمشروع:</label>
      <input type="number" id="totalCost" placeholder="أدخل التكلفة الإجمالية">
      
      <label for="currency" title="اختر العملة المستخدمة">اختر العملة:</label>
      <select id="currency">
        <option value="YER" selected>الريال اليمني (YER)</option>
        <option value="USD">الدولار الأمريكي (USD)</option>
      </select>
      
      <label for="exchangeRate" title="أدخل سعر الصرف">سعر الصرف (ريال/دولار):</label>
      <input type="number" id="exchangeRate" placeholder="أدخل سعر الصرف" value="250">
      <button onclick="updateExchangeRate()" class="btn-animate" style="margin-bottom:15px;">
        <i class="fas fa-sync-alt"></i> تحديث سعر الصرف
      </button>
      
      <!-- زر إنشاء المخطط الأولي -->
      <button onclick="generateFloorPlan()" class="btn-animate" style="background: var(--secondary-color);">
        <i class="fas fa-drafting-compass"></i> إنشاء المخطط الأولي
      </button>
    </div>
    
    <!-- قسم عرض المخطط الأولي (النماذج الافتراضية) -->
    <div class="section design-section" id="designResults" data-aos="fade-up">
      <h2 id="initialDesignsTitle" data-key="initialDesignsTitle">المخططات الأولية المقترحة</h2>
      <div id="floorPlanPreview" class="design-grid">
        <!-- ستظهر النماذج الافتراضية هنا -->
      </div>
      <div class="export-buttons">
        <button onclick="printResult()" class="btn-animate">
          <i class="fas fa-print"></i> مشاركة/طباعة المخطط
        </button>
        <button onclick="exportPDF()" class="btn-animate">
          <i class="fas fa-file-pdf"></i> تصدير إلى PDF
        </button>
        <button onclick="exportExcel()" class="btn-animate">
          <i class="fas fa-file-excel"></i> تصدير إلى Excel
        </button>
      </div>
    </div>
    
    <!-- قسم تقدير الكميات والتكلفة مع جدول المواد والجدول الزمني والمخطط الإداري -->
    <div class="section estimation-section" id="estimationSection" data-aos="fade-up">
      <h2 id="quantityEstimationTitle" data-key="quantityEstimationTitle">تقدير الكميات والتكلفة</h2>
      <div class="estimation-form">
        <label>إدخال المواد والتكاليف:</label>
        <input type="text" id="materialName" placeholder="اسم المادة">
        <input type="number" id="materialQuantity" placeholder="الكمية">
        <input type="number" id="materialCost" placeholder="تكلفة الوحدة">
        <button onclick="addMaterial()" class="btn-animate">إضافة المادة</button>
      </div>
      <table class="schedule-table" id="materialsTable">
        <thead>
          <tr>
            <th>اسم المادة</th>
            <th>الكمية</th>
            <th>تكلفة الوحدة</th>
            <th>التكلفة الإجمالية</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <h3 style="margin-top:20px;">الجدول الزمني والمخطط الإداري</h3>
      <div style="margin-top:10px;">
        <label>إضافة مهمة للمخطط الإداري:</label>
        <input type="text" id="taskName" placeholder="اسم المهمة">
        <input type="date" id="startDate">
        <input type="date" id="endDate">
        <button onclick="addTask()" class="btn-animate">إضافة مهمة</button>
      </div>
      <table class="schedule-table" id="scheduleTable">
        <thead>
          <tr>
            <th>اسم المهمة</th>
            <th>تاريخ البدء</th>
            <th>تاريخ الانتهاء</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <h3 style="margin-top:20px;">المخطط الإداري</h3>
      <table class="schedule-table" id="adminPlanTable">
        <thead>
          <tr>
            <th>المرحلة</th>
            <th>الوصف</th>
            <th>المدة الزمنية</th>
          </tr>
        </thead>
        <tbody>
          <!-- يتم توليد بيانات المخطط الإداري تلقائيًا (محاكاة) -->
        </tbody>
      </table>
    </div>
    
    <!-- قسم التحليل المالي -->
    <div class="section financial-analysis-section" id="financialSection" data-aos="fade-up">
      <h2>التحليل المالي</h2>
      <p>أدخل المعطيات المالية لتحليل جدوى المشروع:</p>
      <input type="number" id="annualRevenue" placeholder="الإيرادات السنوية المتوقعة (بالعملة)">
      <input type="number" id="projectDuration" placeholder="مدة المشروع (بالسنوات)">
      <input type="number" id="discountRate" placeholder="معدل الخصم (%)">
      <button onclick="calculateFinancials()" class="btn-animate">احسب التحليل المالي</button>
      <p id="financialResult"></p>
    </div>
    
    <!-- قسم المخطط الزمني التفاعلي -->
    <div class="section gantt-section" id="ganttSection" data-aos="fade-up">
      <h2>المخطط الزمني التفاعلي</h2>
      <div id="ganttChart"></div>
    </div>
    
    <!-- قسم منصات التصميم والتخطيط -->
    <div class="section platforms-section" id="platformsSection" data-aos="fade-up">
      <h2>منصات التصميم والتخطيط</h2>
      <div class="platforms-buttons">
        <a href="https://www.autodesk.com/products/autocad/" target="_blank"><i class="fas fa-pencil-alt"></i> AutoCAD</a>
        <a href="https://www.autodesk.com/products/revit/" target="_blank"><i class="fas fa-building"></i> Revit</a>
        <a href="https://www.sketchup.com/" target="_blank"><i class="fas fa-drafting-compass"></i> SketchUp</a>
        <a href="https://www.rhino3d.com/" target="_blank"><i class="fas fa-cube"></i> Rhino</a>
        <a href="https://www.graphisoft.com/archicad" target="_blank"><i class="fas fa-sitemap"></i> ArchiCAD</a>
        <a href="https://www.chiefarchitect.com/" target="_blank"><i class="fas fa-home"></i> Chief Architect</a>
      </div>
    </div>
    
    <!-- قسم محادثة الذكاء الاصطناعي (ChatGPT) -->
    <div class="section external-ai-section" id="externalAISection" data-aos="fade-up">
      <h2>محادثة الذكاء الاصطناعي (ChatGPT)</h2>
      <div>
        <input type="text" id="aiSearchInput" placeholder="أدخل استفسارك هنا...">
        <button onclick="searchWithAI()" class="btn-animate">أرسل الاستفسار</button>
      </div>
      <iframe src="https://poe.com/ChatGPT" style="width: 100%; height: 500px; border: none;" allowfullscreen loading="lazy"></iframe>
    </div>
    
    <!-- قسم أدوات التحليل الهندسي -->
    <div class="section engineering-tools-section" id="engineeringToolsSection" data-aos="fade-up">
      <h2 id="engineeringToolsTitle" data-key="engineeringToolsTitle">أدوات التحليل الهندسي</h2>
      <!-- حساب عزم الانحناء -->
      <div class="engineering-tool-group">
        <label>حساب عزم الانحناء</label>
        <input type="number" id="forceInput" placeholder="القوة (نيوتن)">
        <input type="number" id="distanceInput" placeholder="المسافة (متر)">
        <button onclick="calculateMoment()" class="btn-animate">احسب العزم</button>
        <p id="momentResult"></p>
      </div>
      <!-- حساب انحراف العارضة -->
      <div class="engineering-tool-group">
        <label>حساب انحراف العارضة</label>
        <input type="number" id="loadInput" placeholder="الحمل (كغ)">
        <input type="number" id="lengthInput" placeholder="طول العارضة (متر)">
        <input type="number" id="modulusInput" placeholder="معامل يونغ (GPa)">
        <input type="number" id="inertiaInput" placeholder="لحظة العزم (م^4)">
        <button onclick="calculateBeamDeflection()" class="btn-animate">احسب الانحراف</button>
        <p id="deflectionResult"></p>
      </div>
      <!-- حساب الإجهاد -->
      <div class="engineering-tool-group stress-group">
        <label>حساب الإجهاد</label>
        <input type="number" id="stressForce" placeholder="القوة (نيوتن)">
        <input type="number" id="stressArea" placeholder="مساحة المقطع (م²)">
        <button onclick="calculateStress()" class="btn-animate">احسب الإجهاد</button>
        <p id="stressResult"></p>
      </div>
    </div>
    
    <!-- قسم تحليل الموقع -->
    <div class="section location-analysis-section" id="locationSection" data-aos="fade-up">
      <h2>تحليل الموقع</h2>
      <p>أدخل عنوان الموقع أو الإحداثيات (مثلاً: 15.354, 44.207):</p>
      <input type="text" id="locationInput" placeholder="أدخل العنوان أو الإحداثيات">
      <button onclick="updateMap()" class="btn-animate">عرض الخريطة</button>
      <iframe id="locationMap" src="https://www.openstreetmap.org/export/embed.html?bbox=44.205,15.352,44.209,15.356&amp;layer=mapnik" allowfullscreen loading="lazy"></iframe>
    </div>
    
    <!-- قسم إحصائيات المشروع (Dashboard) -->
    <div class="section dashboard-section" id="projectStatsSection" data-aos="fade-up">
      <h2>إحصائيات المشروع</h2>
      <canvas id="progressLineChart" style="max-width:800px; margin:20px auto;"></canvas>
    </div>
    
    <!-- قسم الدعم الفني / الأسئلة الشائعة -->
    <div class="section faq-section" id="faqSection" data-aos="fade-up">
      <h2 style="color: var(--primary-color);">الدعم الفني / الأسئلة الشائعة</h2>
      <details style="background: #f0f0f0; padding: 10px; border-radius: 4px; margin-bottom: 5px;">
        <summary style="font-weight: bold;">كيف أبدأ باستخدام النظام؟</summary>
        <p>ابدأ بإدخال معطيات المشروع الأساسية في النموذج الموجود في قسم "معطيات المشروع".</p>
      </details>
      <details style="background: #f0f0f0; padding: 10px; border-radius: 4px; margin-bottom: 5px;">
        <summary style="font-weight: bold;">كيف يمكنني استخدام أدوات التحليل الهندسي؟</summary>
        <p>انتقل إلى قسم "أدوات التحليل الهندسي" وأدخل المعطيات المطلوبة لحساب العزم، الانحراف أو الإجهاد.</p>
      </details>
      <details style="background: #f0f0f0; padding: 10px; border-radius: 4px; margin-bottom: 5px;">
        <summary style="font-weight: bold;">كيف يمكنني الحصول على تحليل مالي للمشروع؟</summary>
        <p>انتقل إلى قسم "التحليل المالي" وأدخل الإيرادات السنوية، مدة المشروع ومعدل الخصم لحساب صافي القيمة الحالية وفترة الاسترداد.</p>
      </details>
      <details style="background: #f0f0f0; padding: 10px; border-radius: 4px; margin-bottom: 5px;">
        <summary style="font-weight: bold;">كيف يمكنني الحصول على تحليل موقع المشروع؟</summary>
        <p>اكتب العنوان أو الإحداثيات في قسم "تحليل الموقع" واضغط على "عرض الخريطة".</p>
      </details>
    </div>
    
    <!-- قسم دليل المستخدم -->
    <div class="info-section" data-aos="fade-up">
      <h2 id="userGuideTitle" data-key="userGuideTitle" style="color: var(--primary-color);">دليل المستخدم</h2>
      <p style="color: #555;">توضح هذه الوثيقة كيفية استخدام النظام خطوة بخطوة:</p>
      <ul style="list-style: disc; margin-right: 20px; color: #555;">
        <li>أدخل معطيات المشروع الأساسية مثل مساحة الأرض، مساحة البناء، عدد الأدوار، غرف النوم، الحمامات، المطابخ، وغرف المعيشة.</li>
        <li>حدد تفاصيل تقسيم الأرض واتجاه المبنى والنمط التصميمي.</li>
        <li>اضغط على "إنشاء المخطط الأولي" لتوليد النماذج التصميمية الأولية تلقائيًا.</li>
        <li>يمكنك إعادة ترتيب البطاقات باستخدام السحب والإفلات.</li>
        <li>استخدم قسم "عرض التصميم" للتبديل بين العرض الثنائي والثلاثي الأبعاد.</li>
        <li>جرّب سيناريوهات مختلفة واحفظها للمقارنة.</li>
        <li>يمكنك تصدير النتائج إلى PDF أو Excel أو طباعتها مباشرةً.</li>
        <li>استفد من قسم "أدوات التحليل الهندسي" لحساب عزم الانحناء، انحراف العارضة، الإجهاد وغيرها من التحليلات.</li>
        <li>استخدم قسم "تقدير الكميات والتكلفة" لإدخال المواد وحساب التكلفة الإجمالية مع الجدول الزمني والمخطط الإداري.</li>
        <li>انتقل إلى قسم "التحليل المالي" لتحليل جدوى المشروع وحساب NPV وفترة الاسترداد.</li>
        <li>استخدم قسم "تحليل الموقع" للحصول على خريطة الموقع.</li>
        <li>تواصل مع محرك الذكاء الاصطناعي عبر قسم "محادثة الذكاء الاصطناعي (ChatGPT)".</li>
        <li>استفد من قسم "منصات التصميم والتخطيط" للوصول إلى أدوات خارجية مشهورة.</li>
        <li>تابع لوحة المعلومات وإحصائيات المشروع لتقييم التقدم.</li>
        <li>استخدم قسم "الدعم الفني / الأسئلة الشائعة" للحصول على المساعدة.</li>
        <li>قم برفع الملفات والمستندات الخاصة بالمشروع.</li>
      </ul>
    </div>
    
    <!-- قسم المعايير الهندسية -->
    <div class="info-section" data-aos="fade-up">
      <h2 id="engineeringStandardsTitle" data-key="engineeringStandardsTitle" style="color: var(--primary-color);">المعايير الهندسية والتصميمية العالمية</h2>
      <p style="color: #555;">يستند التصميم إلى معايير هندسية عالمية تشمل:</p>
      <ul style="list-style: disc; margin-right: 20px; color: #555;">
        <li>توزيع المساحات بدقة لضمان استغلال أمثل للأرض.</li>
        <li>اختيار اتجاه الواجهة الرئيسية لتحقيق أفضل إضاءة وتهوية طبيعية.</li>
        <li>اعتماد أنماط تصميمية وفقًا لأفضل الممارسات العالمية.</li>
        <li>تطبيق معايير السلامة والجودة باستخدام مواد بناء معتمدة.</li>
        <li>تحليل التكلفة والتشغيل لتحقيق جدوى اقتصادية متكاملة.</li>
      </ul>
    </div>
    
    <!-- قسم أهم الأدوات الخاصة بالتصميم والتخطيط -->
    <div class="info-section" data-aos="fade-up">
      <h2 id="designStepsTitle" data-key="designStepsTitle" style="color: var(--primary-color);">أهم الأدوات الخاصة بالتصميم والتخطيط</h2>
      <ul style="list-style: disc; margin-right: 20px; color: #555;">
        <li>استخدام منصات مثل AutoCAD، Revit، SketchUp، Rhino، ArchiCAD، Chief Architect.</li>
        <li>الاستفادة من أدوات التخطيط الجرافيكي والتصميم الثلاثي الأبعاد.</li>
        <li>دمج تحليلات التكلفة والجدوى المالية في مراحل التصميم.</li>
      </ul>
    </div>
    
  </div>
  
  <!-- الفوتر -->
  <footer style="background: #333; color: #ccc; padding: 20px; text-align: center; direction: rtl; margin-top: 40px;">
    <p style="margin-bottom: 10px;">© 2024 منصة الاتحاد العام للمقاولين اليمنيين - جميع الحقوق محفوظة</p>
    <p>
      <a href="https://guyc-yemen.com/" style="color: var(--accent-color); text-decoration: none;">الموقع الرسمي</a> |
      <a href="mailto:info@guyc-ye.com" style="color: var(--accent-color); text-decoration: none;">البريد الإلكتروني</a> |
      <a href="tel:01450553" style="color: var(--accent-color); text-decoration: none;">01-450553</a>
    </p>
    <p style="margin-top: 10px;">
      <a href="#" style="color: var(--accent-color); margin: 0 5px; text-decoration: none;"><i class="fab fa-facebook"></i></a>
      <a href="#" style="color: var(--accent-color); margin: 0 5px; text-decoration: none;"><i class="fab fa-twitter"></i></a>
      <a href="#" style="color: var(--accent-color); margin: 0 5px; text-decoration: none;"><i class="fab fa-youtube"></i></a>
      <a href="#" style="color: var(--accent-color); margin: 0 5px; text-decoration: none;"><i class="fab fa-whatsapp"></i></a>
    </p>
  </footer>
  
  <!-- استدعاء مكتبة AOS -->
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    /* إعدادات اللغة */
    const translations = {
      "ar": {
        "navTitle": "نظام التصميم الذكي",
        "mainTitle": "أداة التصميم والتخطيط الذكي للمنشآت – النظام المتطور",
        "projectDataTitle": "معطيات المشروع",
        "initialDesignsTitle": "المخططات الأولية المقترحة",
        "viewDesignTitle": "عرض التصميم",
        "scenarioAnalysisTitle": "تحليل السيناريوهات ومقارنتها",
        "costReportTitle": "نتائج التحليل والتكلفة",
        "smartRecommendationsTitle": "التوصيات الذكية",
        "manualDesignTitle": "التصميم اليدوي",
        "quantityEstimationTitle": "تقدير الكميات والتكلفة",
        "projectManagementTitle": "إدارة المشروع",
        "userGuideTitle": "دليل المستخدم",
        "engineeringStandardsTitle": "المعايير الهندسية والتصميمية العالمية",
        "designStepsTitle": "أهم الأدوات والخطوات",
        "similarDesignsTitle": "تصاميم مشابهة",
        "aiToolsTitle": "أدوات الذكاء الاصطناعي",
        "engineeringToolsTitle": "أدوات التحليل الهندسي"
      },
      "en": {
        "navTitle": "Smart Design System",
        "mainTitle": "Smart Design and Planning Tool – Advanced System",
        "projectDataTitle": "Project Data",
        "initialDesignsTitle": "Initial Design Proposals",
        "viewDesignTitle": "Design View",
        "scenarioAnalysisTitle": "Scenario Analysis & Comparison",
        "costReportTitle": "Cost Analysis & Report",
        "smartRecommendationsTitle": "Smart Recommendations",
        "manualDesignTitle": "Manual Design",
        "quantityEstimationTitle": "Quantity Estimation & Cost",
        "projectManagementTitle": "Project Management",
        "userGuideTitle": "User Guide",
        "engineeringStandardsTitle": "Engineering & Design Standards",
        "designStepsTitle": "Key Tools & Steps",
        "similarDesignsTitle": "Similar Designs",
        "aiToolsTitle": "AI Tools",
        "engineeringToolsTitle": "Engineering Analysis Tools"
      }
    };
    let currentLanguage = localStorage.getItem('language') || 'ar';
    function updateLanguageTexts() {
      document.getElementById('navTitle').innerText = translations[currentLanguage].navTitle;
      document.getElementById('mainTitle').innerText = translations[currentLanguage].mainTitle;
      document.getElementById('projectDataTitle').innerText = translations[currentLanguage].projectDataTitle;
      document.getElementById('initialDesignsTitle').innerText = translations[currentLanguage].initialDesignsTitle;
      document.getElementById('viewDesignTitle').innerText = translations[currentLanguage].viewDesignTitle;
      document.getElementById('scenarioAnalysisTitle').innerText = translations[currentLanguage].scenarioAnalysisTitle;
      document.getElementById('costReportTitle').innerText = translations[currentLanguage].costReportTitle;
      document.getElementById('smartRecommendationsTitle').innerText = translations[currentLanguage].smartRecommendationsTitle;
      document.getElementById('quantityEstimationTitle').innerText = translations[currentLanguage].quantityEstimationTitle;
      document.getElementById('projectManagementTitle').innerText = translations[currentLanguage].projectManagementTitle;
      document.getElementById('userGuideTitle').innerText = translations[currentLanguage].userGuideTitle;
      document.getElementById('engineeringStandardsTitle').innerText = translations[currentLanguage].engineeringStandardsTitle;
      document.getElementById('designStepsTitle').innerText = translations[currentLanguage].designStepsTitle;
      document.getElementById('similarDesignsTitle').innerText = translations[currentLanguage].similarDesignsTitle;
      document.getElementById('aiToolsTitle').innerText = translations[currentLanguage].aiToolsTitle;
      document.getElementById('engineeringToolsTitle').innerText = translations[currentLanguage].engineeringToolsTitle;
    }
    function toggleLanguage() {
      currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
      localStorage.setItem('language', currentLanguage);
      updateLanguageTexts();
    }
    /* وظيفة تبديل الوضع الداكن/الفاتح */
    function toggleDarkMode() {
      document.body.classList.toggle("light-mode");
    }
    /* وظيفة تطبيق إعدادات النظام */
    function applySettings() {
      const primary = document.getElementById("primaryColorInput").value;
      const secondary = document.getElementById("secondaryColorInput").value;
      const accent = document.getElementById("accentColorInput").value;
      const fontSize = document.getElementById("fontSizeInput").value + "px";
      const fontFamily = document.getElementById("fontFamilySelect").value;
      
      document.documentElement.style.setProperty("--primary-color", primary);
      document.documentElement.style.setProperty("--secondary-color", secondary);
      document.documentElement.style.setProperty("--accent-color", accent);
      document.documentElement.style.setProperty("--font-size", fontSize);
      document.documentElement.style.setProperty("--font-family", fontFamily);
      
      alert("تم تطبيق الإعدادات بنجاح.");
      
      localStorage.setItem("primaryColor", primary);
      localStorage.setItem("secondaryColor", secondary);
      localStorage.setItem("accentColor", accent);
      localStorage.setItem("fontSize", fontSize);
      localStorage.setItem("fontFamily", fontFamily);
    }
    function loadSettings() {
      const primary = localStorage.getItem("primaryColor");
      const secondary = localStorage.getItem("secondaryColor");
      const accent = localStorage.getItem("accentColor");
      const fontSize = localStorage.getItem("fontSize");
      const fontFamily = localStorage.getItem("fontFamily");
      if(primary && secondary && accent && fontSize && fontFamily) {
        document.documentElement.style.setProperty("--primary-color", primary);
        document.documentElement.style.setProperty("--secondary-color", secondary);
        document.documentElement.style.setProperty("--accent-color", accent);
        document.documentElement.style.setProperty("--font-size", fontSize);
        document.documentElement.style.setProperty("--font-family", fontFamily);
        document.getElementById("primaryColorInput").value = primary;
        document.getElementById("secondaryColorInput").value = secondary;
        document.getElementById("accentColorInput").value = accent;
        document.getElementById("fontSizeInput").value = parseInt(fontSize);
        document.getElementById("fontFamilySelect").value = fontFamily;
      }
    }
    /* عرض الوقت والتاريخ بنظام 12 ساعة */
    function updateDateTime() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      const timeString = `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')} ${ampm}`;
      const dateString = now.toLocaleDateString();
      document.getElementById("dateTimeDisplay").innerText = dateString + " " + timeString;
    }
    setInterval(updateDateTime, 1000);
    
    /* عند تحميل الصفحة */
    window.addEventListener('load', () => {
      AOS.init();
      document.getElementById('loader').style.display = 'none';
      loadInputs();
      updateCostChart();
      updateLanguageTexts();
      loadSettings();
      if(document.getElementById("floorPlanPreview")){
        Sortable.create(document.getElementById("floorPlanPreview"), { animation: 150 });
      }
      loadProjectTasks();
      populateSimilarDesigns();
      getRandomAIDecision();
      updateDashboard();
      initGanttChart();
      loadComments();
      initFileUpload();
      initProgressChart();
      updateDateTime();
      generateAdminPlan();
    });
    
    /* --- وظائف النظام الأساسية --- */
    function saveInputs() {
      const inputs = {
        projectName: document.getElementById('projectName').value,
        landArea: document.getElementById('projectArea').value,
        buildingArea: document.getElementById('buildingArea').value,
        numFloors: document.getElementById('numFloors').value,
        numRooms: document.getElementById('numRooms').value,
        numBathrooms: document.getElementById('numBathrooms').value,
        numKitchens: document.getElementById('numKitchens').value,
        numLivingRooms: document.getElementById('numLivingRooms').value,
        landDivision: document.getElementById('landDivision').value,
        buildingOrientation: document.getElementById('buildingOrientation').value,
        designStyle: document.getElementById('designStyle').value,
        totalCost: document.getElementById('totalCost').value,
        exchangeRate: document.getElementById('exchangeRate').value
      };
      localStorage.setItem('designInputs', JSON.stringify(inputs));
    }
    function loadInputs() {
      const saved = localStorage.getItem('designInputs');
      if (saved) {
        const inputs = JSON.parse(saved);
        document.getElementById('projectName').value = inputs.projectName || "";
        document.getElementById('projectArea').value = inputs.landArea || "";
        document.getElementById('buildingArea').value = inputs.buildingArea || "";
        document.getElementById('numFloors').value = inputs.numFloors || "";
        document.getElementById('numRooms').value = inputs.numRooms || "";
        document.getElementById('numBathrooms').value = inputs.numBathrooms || "";
        document.getElementById('numKitchens').value = inputs.numKitchens || "";
        document.getElementById('numLivingRooms').value = inputs.numLivingRooms || "";
        document.getElementById('landDivision').value = inputs.landDivision || "";
        document.getElementById('buildingOrientation').value = inputs.buildingOrientation || "north";
        document.getElementById('designStyle').value = inputs.designStyle || "european";
        document.getElementById('totalCost').value = inputs.totalCost || "";
        document.getElementById('exchangeRate').value = inputs.exchangeRate || "250";
      }
    }
    function updateExchangeRate() {
      fetch("https://api.exchangerate-api.com/v4/latest/USD")
        .then(response => response.json())
        .then(data => {
          if(data && data.rates && data.rates["YER"]) {
            const rate = data.rates["YER"];
            document.getElementById("exchangeRate").value = rate;
            alert("تم تحديث سعر الصرف: " + rate);
            saveInputs();
          } else {
            alert("تعذر الحصول على سعر الصرف.");
          }
        })
        .catch(err => alert("فشل تحديث سعر الصرف: " + err));
    }
    const inputFields = document.querySelectorAll('#dataSection input, #dataSection select');
    let debounceTimer;
    inputFields.forEach(field => {
      field.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
          generateFloorPlan();
          saveInputs();
          updateDashboard();
        }, 500);
      });
    });
    function calculateCostAnalysis() {
      let totalCost = parseFloat(document.getElementById('totalCost').value) || 0;
      let buildingArea = parseFloat(document.getElementById('buildingArea').value) || 0;
      if (buildingArea > 0) {
        let costPerM2 = totalCost / buildingArea;
        return "التكلفة لكل م²: " + costPerM2.toFixed(2) + " " + document.getElementById('currency').value;
      }
      return "لم يتم إدخال مساحة البناء أو التكلفة.";
    }
    function generateFloorPlan() {
      const projectName = document.getElementById('projectName').value || "المشروع غير محدد";
      const buildingArea = parseFloat(document.getElementById('buildingArea').value) || 0;
      const numRooms = parseInt(document.getElementById('numRooms').value) || 0;
      const numBathrooms = parseInt(document.getElementById('numBathrooms').value) || 0;
      const numKitchens = parseInt(document.getElementById('numKitchens').value) || 0;
      const numLivingRooms = parseInt(document.getElementById('numLivingRooms').value) || 0;
      const landDivision = document.getElementById('landDivision').value || "60% مبنى، 20% حديقة، 10% كراج، 10% مدخل";
      const buildingOrientation = document.getElementById('buildingOrientation').value;
      const designStyle = document.getElementById('designStyle').value;
      let proposals = [];
      if(designStyle === "european") {
        proposals = [
          {
            title: "تصميم أوروبي كلاسيكي",
            description: "تصميم متوازن مع واجهات فاخرة وحدائق واسعة؛ يناسب المشاريع الراقية.",
            image: "https://via.placeholder.com/400x250?text=أوروبي+كلاسيكي"
          },
          {
            title: "تصميم أوروبي معاصر",
            description: "يعتمد على توزيع مفتوح ومساحات داخلية عصرية.",
            image: "https://via.placeholder.com/400x250?text=أوروبي+معاصر"
          }
        ];
      } else if(designStyle === "american") {
        proposals = [
          {
            title: "تصميم أمريكي عصري",
            description: "مساحات واسعة ونوافذ كبيرة لإضاءة طبيعية مثالية.",
            image: "https://via.placeholder.com/400x250?text=أمريكي+عصري"
          },
          {
            title: "تصميم أمريكي عملي",
            description: "استغلال أمثل للمساحة مع توزيع وظيفي متكامل.",
            image: "https://via.placeholder.com/400x250?text=أمريكي+عملي"
          }
        ];
      } else if(designStyle === "asian") {
        proposals = [
          {
            title: "تصميم آسيوي هادئ",
            description: "يعكس الانسجام مع الطبيعة بخطوط بسيطة.",
            image: "https://via.placeholder.com/400x250?text=آسيوي+هادئ"
          },
          {
            title: "تصميم آسيوي معاصر",
            description: "يجمع بين البساطة والعصرية.",
            image: "https://via.placeholder.com/400x250?text=آسيوي+معاصر"
          }
        ];
      } else if(designStyle === "eastern") {
        proposals = [
          {
            title: "تصميم شرقي تقليدي",
            description: "تفاصيل دقيقة وزخارف فنية كلاسيكية.",
            image: "https://via.placeholder.com/400x250?text=شرقي+تقليدي"
          },
          {
            title: "تصميم شرقي حديث",
            description: "دمج بين التقاليد والحداثة.",
            image: "https://via.placeholder.com/400x250?text=شرقي+حديث"
          }
        ];
      } else if(designStyle === "modern") {
        proposals = [
          {
            title: "تصميم حديث مبتكر",
            description: "استخدام تقنيات تصميم ذكية وواجهات زجاجية.",
            image: "https://via.placeholder.com/400x250?text=حديث+مبتكر"
          },
          {
            title: "تصميم مودرن عملي",
            description: "تحقيق أفضل استغلال للمساحات بتقنيات حديثة.",
            image: "https://via.placeholder.com/400x250?text=مودرن+عملي"
          }
        ];
      } else if(designStyle === "traditional") {
        proposals = [
          {
            title: "تصميم تقليدي كلاسيكي",
            description: "أساليب تقليدية مع مواد طبيعية.",
            image: "https://via.placeholder.com/400x250?text=تقليدي+كلاسيكي"
          },
          {
            title: "تصميم تقليدي معاصر",
            description: "دمج الأصالة مع لمسات عصرية.",
            image: "https://via.placeholder.com/400x250?text=تقليدي+معاصر"
          }
        ];
      }
      let allProposals = proposals;
      if(allProposals.length < 6) {
        while(allProposals.length < 6) {
          allProposals = allProposals.concat(proposals);
        }
        allProposals = allProposals.slice(0, 6);
      }
      let html = "";
      allProposals.forEach((proposal, index) => {
        html += `
          <div class="design-card btn-animate" data-aos="fade-up">
            <div class="card-header">${proposal.title}</div>
            <div class="card-content">
              <p>${proposal.description}</p>
              <p><strong>تقسيم الأرض:</strong> ${landDivision}</p>
              <p><strong>اتجاه المبنى:</strong> ${getOrientationLabel(buildingOrientation)}</p>
            </div>
            <img src="${proposal.image}" alt="${proposal.title}" loading="lazy">
          </div>
        `;
      });
      document.getElementById("floorPlanPreview").innerHTML = html;
      const costText = calculateCostAnalysis();
      document.getElementById("costAnalysis").innerText = costText;
      updateCostChart();
      generateSmartRecommendations();
    }
    function getOrientationLabel(orientation) {
      switch (orientation) {
        case "north": return "شمال";
        case "south": return "جنوب";
        case "east":  return "شرق";
        case "west":  return "غرب";
        default: return orientation;
      }
    }
    function resetDesignTool() {
      document.getElementById('projectName').value = "";
      document.getElementById('projectArea').value = "";
      document.getElementById('buildingArea').value = "";
      document.getElementById('numFloors').value = "";
      document.getElementById('numRooms').value = "";
      document.getElementById('numBathrooms').value = "";
      document.getElementById('numKitchens').value = "";
      document.getElementById('numLivingRooms').value = "";
      document.getElementById('landDivision').value = "";
      document.getElementById('buildingOrientation').selectedIndex = 0;
      document.getElementById('designStyle').selectedIndex = 0;
      document.getElementById('totalCost').value = "";
      document.getElementById('exchangeRate').value = "250";
      document.getElementById('floorPlanPreview').innerHTML = "";
      document.getElementById('resultSection').innerHTML = "<h2>النتائج والتقارير</h2><p id='costAnalysis'></p><canvas id='costChart' style='max-width: 800px; margin: 20px auto;'></canvas><canvas id='materialsPieChart' style='max-width: 400px; margin: 20px auto;'></canvas>";
      document.getElementById('scenarioResults').innerHTML = "";
      document.getElementById('scenarioComparison').innerHTML = "";
      localStorage.removeItem('designInputs');
    }
    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "mm", "a4");
      doc.setFont("Arial", "normal");
      doc.text("تقرير أداة التصميم والتخطيط الذكي للمنشآت", 20, 20);
      const results = document.getElementById("resultSection").innerText;
      doc.text(results, 20, 40);
      doc.text("يرجى مراجعة المخطط والمعطيات للحصول على التفاصيل الكاملة.", 20, 60);
      doc.save("تقرير_التصميم.pdf");
    }
    function exportExcel() {
      let data = [
        ["المخطط الأولي", document.getElementById('floorPlanPreview').innerText],
        ["نتائج التحليل", document.getElementById('resultSection').innerText]
      ];
      let ws = XLSX.utils.aoa_to_sheet(data);
      let wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "التصميم");
      XLSX.writeFile(wb, "تقرير_التصميم.xlsx");
    }
    function printResult() {
      window.print();
    }
    function calculateScenario(scenarioName) {
      generateFloorPlan();
      const details = "تم استخدام المعطيات الحالية لتوليد المخطط الأولي.";
      updateScenarioResult(details, "", "", "", scenarioName);
    }
    function updateScenarioResult(financing, npv, payback, irr, scenarioName) {
      const scenarioDiv = document.getElementById('scenarioResults');
      scenarioDiv.innerHTML = `
        <h3>${scenarioName}</h3>
        <p><strong>${financing}</strong></p>
        <p><strong>${npv}</strong></p>
        <p><strong>${payback}</strong></p>
        <p><strong>${irr}</strong></p>
      `;
    }
    let savedScenarios = [];
    function saveScenario() {
      const scenario = {
        projectName: document.getElementById('projectName').value || "المشروع غير محدد",
        floorPlan: document.getElementById('floorPlanPreview').innerHTML,
        timestamp: new Date().toLocaleString()
      };
      savedScenarios.push(scenario);
      updateScenarioComparison();
    }
    function updateScenarioComparison() {
      const compDiv = document.getElementById('scenarioComparison');
      if (savedScenarios.length === 0) {
        compDiv.innerHTML = "<p>لا توجد سيناريوهات محفوظة.</p>";
        return;
      }
      let tableHTML = `<table>
                          <thead>
                            <tr style="background-color: var(--primary-color); color: #fff;">
                              <th style="padding: 10px;">التاريخ</th>
                              <th style="padding: 10px;">اسم المشروع</th>
                              <th style="padding: 10px;">عرض المخطط</th>
                            </tr>
                          </thead>
                          <tbody>`;
      savedScenarios.forEach(scn => {
        tableHTML += `<tr>
                        <td style="padding: 10px;">${scn.timestamp}</td>
                        <td style="padding: 10px;">${scn.projectName}</td>
                        <td style="padding: 10px;">
                          <button onclick="viewScenario('${scn.timestamp}')" class="btn-animate">
                            <i class="fas fa-eye"></i> عرض
                          </button>
                        </td>
                      </tr>`;
      });
      tableHTML += `</tbody></table>`;
      compDiv.innerHTML = `<h3>مقارنة السيناريوهات المحفوظة</h3>` + tableHTML;
    }
    function viewScenario(timestamp) {
      const scenario = savedScenarios.find(s => s.timestamp === timestamp);
      if (scenario) {
        document.getElementById('floorPlanPreview').innerHTML = scenario.floorPlan;
        alert("تم عرض السيناريو المحفوظ بتاريخ " + scenario.timestamp);
      }
    }
    function show2DView() {
      document.getElementById('view2DContainer').style.display = "block";
      document.getElementById('view3DContainer').style.display = "none";
      render2DPlan();
    }
    function show3DView() {
      document.getElementById('view2DContainer').style.display = "none";
      document.getElementById('view3DContainer').style.display = "block";
      render3DPlan();
    }
    function render2DPlan() {
      const canvas = document.getElementById("view2D");
      const ctx = canvas.getContext("2d");
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = "#8B4513";
      ctx.lineWidth = 2;
      let planWidth = canvas.width * 0.6;
      let planHeight = canvas.height * 0.6;
      let startX = (canvas.width - planWidth) / 2;
      let startY = (canvas.height - planHeight) / 2;
      ctx.strokeRect(startX, startY, planWidth, planHeight);
      ctx.fillStyle = "#333";
      ctx.font = "18px Cairo, sans-serif";
      ctx.fillText("اتجاه: " + getOrientationLabel(document.getElementById('buildingOrientation').value), startX, startY - 10);
      let bedroomsHeight = planHeight * 0.4;
      let bathroomsHeight = planHeight * 0.15;
      let kitchensHeight = planHeight * 0.15;
      let livingHeight = planHeight * 0.3;
      ctx.strokeStyle = "#FF5733";
      ctx.strokeRect(startX, startY, planWidth, bedroomsHeight);
      ctx.fillText("غرف النوم (" + document.getElementById('numRooms').value + ")", startX + 5, startY + 20);
      let bathroomsY = startY + bedroomsHeight;
      ctx.strokeStyle = "#33A1FF";
      ctx.strokeRect(startX, bathroomsY, planWidth, bathroomsHeight);
      ctx.fillText("الحمامات (" + document.getElementById('numBathrooms').value + ")", startX + 5, bathroomsY + 20);
      let kitchensY = bathroomsY + bathroomsHeight;
      ctx.strokeStyle = "#33FF77";
      ctx.strokeRect(startX, kitchensY, planWidth, kitchensHeight);
      ctx.fillText("المطابخ (" + document.getElementById('numKitchens').value + ")", startX + 5, kitchensY + 20);
      let livingY = kitchensY + kitchensHeight;
      ctx.strokeStyle = "#FF33A8";
      ctx.strokeRect(startX, livingY, planWidth, livingHeight);
      ctx.fillText("غرف المعيشة (" + document.getElementById('numLivingRooms').value + ")", startX + 5, livingY + 20);
    }
    let threeScene, threeCamera, threeRenderer, orbitControls;
    function render3DPlan() {
      const container = document.getElementById("view3DContainer");
      while (container.firstChild) { container.removeChild(container.firstChild); }
      threeScene = new THREE.Scene();
      threeCamera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
      threeRenderer = new THREE.WebGLRenderer({ antialias: true });
      threeRenderer.setSize(container.offsetWidth, container.offsetHeight);
      container.appendChild(threeRenderer.domElement);
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      threeScene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
      directionalLight.position.set(10, 10, 10);
      threeScene.add(directionalLight);
      const gridHelper = new THREE.GridHelper(20, 20);
      threeScene.add(gridHelper);
      const geometry = new THREE.BoxGeometry(4, 2, 6);
      const material = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
      const building = new THREE.Mesh(geometry, material);
      building.position.set(0, 1, 0);
      threeScene.add(building);
      threeCamera.position.set(10, 10, 10);
      orbitControls = new THREE.OrbitControls(threeCamera, threeRenderer.domElement);
      orbitControls.enableDamping = true;
      orbitControls.dampingFactor = 0.1;
      function animate() {
        requestAnimationFrame(animate);
        orbitControls.update();
        threeRenderer.render(threeScene, threeCamera);
      }
      animate();
    }
    function updateCostChart() {
      const ctx = document.getElementById('costChart').getContext('2d');
      const costAnalysis = calculateCostAnalysis();
      const data = {
        labels: ['التكلفة لكل م²'],
        datasets: [{
          label: 'التكلفة (بالعملة المختارة)',
          data: [parseFloat(costAnalysis.split(': ')[1]) || 0],
          backgroundColor: ['rgba(139, 69, 19, 0.6)'],
          borderColor: ['rgba(139, 69, 19, 1)'],
          borderWidth: 1
        }]
      };
      if(window.costChartInstance) { window.costChartInstance.destroy(); }
      window.costChartInstance = new Chart(ctx, { type: 'bar', data: data, options: { responsive: true, scales: { y: { beginAtZero: true } } } });
      
      const ctxPie = document.getElementById('materialsPieChart').getContext('2d');
      if(materials.length > 0) {
        const labels = materials.map(mat => mat.name);
        const totals = materials.map(mat => mat.total);
        if(window.pieChartInstance) { window.pieChartInstance.destroy(); }
        window.pieChartInstance = new Chart(ctxPie, { type: 'pie', data: { labels: labels, datasets: [{ data: totals, backgroundColor: labels.map(() => 'rgba(100,150,200,0.6)') }] }, options: { responsive: true } });
      }
    }
    function generateSmartRecommendations() {
      const buildingArea = parseFloat(document.getElementById('buildingArea').value) || 0;
      let recommendation = "";
      if(buildingArea > 500) { recommendation = "ينصح باستخدام التصميم الحديث لتحقيق استغلال أمثل للمساحة."; }
      else if(buildingArea > 200) { recommendation = "يمكن تجربة التصميم الأوروبي الكلاسيكي لتحقيق توازن بين الجمالية والوظيفية."; }
      else { recommendation = "يُنصح باختيار تصميم تقليدي معاصر ليتناسب مع حجم المشروع."; }
      document.getElementById("smartRecommendations").innerText = recommendation;
    }
    
    /* --- قسم التحليل المالي --- */
    function calculateFinancials() {
      const annualRevenue = parseFloat(document.getElementById("annualRevenue").value) || 0;
      const duration = parseFloat(document.getElementById("projectDuration").value) || 0;
      const discountRate = parseFloat(document.getElementById("discountRate").value) || 0;
      const initialCost = parseFloat(document.getElementById("totalCost").value) || 0;
      if(annualRevenue > 0 && duration > 0 && discountRate > 0) {
        let npv = -initialCost, cumulative = -initialCost, payback = "غير محدد";
        for(let year = 1; year <= duration; year++){
          const cashFlow = annualRevenue;
          const discounted = cashFlow / Math.pow(1 + discountRate/100, year);
          npv += discounted;
          cumulative += cashFlow;
          if(cumulative >= 0 && payback === "غير محدد") { payback = year; }
        }
        const result = "صافي القيمة الحالية (NPV): " + npv.toFixed(2) + " " + document.getElementById("currency").value +
                       "\nفترة الاسترداد: " + payback + " سنة";
        document.getElementById("financialResult").innerText = result;
      } else { document.getElementById("financialResult").innerText = "يرجى إدخال كافة معطيات التحليل المالي."; }
    }
    
    /* --- قسم محادثة الذكاء الاصطناعي (ChatGPT) --- */
    function searchWithAI(){
      const query = document.getElementById("aiSearchInput").value;
      if(query.trim() === "") { alert("يرجى إدخال استفسار"); }
      else { window.open("https://poe.com/ChatGPT", "_blank"); }
    }
    
    /* --- قسم أدوات التحليل الهندسي --- */
    function calculateMoment() {
      const force = parseFloat(document.getElementById("forceInput").value) || 0;
      const distance = parseFloat(document.getElementById("distanceInput").value) || 0;
      const moment = force * distance;
      document.getElementById("momentResult").innerText = "عزم الانحناء: " + moment.toFixed(2) + " نيوتن.متر";
    }
    function calculateBeamDeflection() {
      const load = parseFloat(document.getElementById("loadInput").value) || 0;
      const length = parseFloat(document.getElementById("lengthInput").value) || 0;
      const modulus = parseFloat(document.getElementById("modulusInput").value) || 0;
      const inertia = parseFloat(document.getElementById("inertiaInput").value) || 0;
      if(load > 0 && length > 0 && modulus > 0 && inertia > 0) {
        const deflection = (load * Math.pow(length, 3)) / (3 * modulus * 1e9 * inertia);
        document.getElementById("deflectionResult").innerText = "انحراف العارضة: " + deflection.toFixed(4) + " متر";
      } else { document.getElementById("deflectionResult").innerText = "يرجى إدخال جميع المعطيات."; }
    }
    function calculateStress() {
      const force = parseFloat(document.getElementById("stressForce").value) || 0;
      const area = parseFloat(document.getElementById("stressArea").value) || 0;
      if(area > 0) {
        const stress = force / area;
        document.getElementById("stressResult").innerText = "الإجهاد: " + stress.toFixed(2) + " باسكال";
      } else { document.getElementById("stressResult").innerText = "يرجى إدخال مساحة المقطع."; }
    }
    
    /* --- قسم تحليل الموقع --- */
    function updateMap() {
      const location = document.getElementById("locationInput").value;
      if(location.trim() !== "") {
        const src = "https://www.openstreetmap.org/export/embed.html?bbox=44.205,15.352,44.209,15.356&amp;layer=mapnik&amp;query=" + encodeURIComponent(location);
        document.getElementById("locationMap").src = src;
      } else { alert("يرجى إدخال عنوان الموقع أو الإحداثيات."); }
    }
    
    /* --- قسم المخطط الزمني (Gantt Chart) --- */
    let gantt;
    function initGanttChart() {
      const tasks = schedule.map((item, index) => ({
        id: "Task " + (index+1),
        name: item.task,
        start: item.start,
        end: item.end,
        progress: 50
      }));
      gantt = new Gantt("#ganttChart", tasks, {
        view_mode: 'Day',
        language: currentLanguage === 'ar' ? 'ar' : 'en'
      });
    }
    function updateGanttChart() {
      if(gantt) {
        const tasks = schedule.map((item, index) => ({
          id: "Task " + (index+1),
          name: item.task,
          start: item.start,
          end: item.end,
          progress: 50
        }));
        gantt.refresh(tasks);
      } else { initGanttChart(); }
    }
    
    /* --- قسم التعليقات --- */
    let comments = [];
    function addComment() {
      const comment = document.getElementById("commentInput").value;
      if(comment.trim() !== "") {
        comments.push({ text: comment, timestamp: new Date().toLocaleString() });
        document.getElementById("commentInput").value = "";
        updateComments();
      } else { alert("يرجى إدخال تعليق."); }
    }
    function updateComments() {
      const ul = document.getElementById("commentsList");
      ul.innerHTML = "";
      comments.forEach(comm => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${comm.timestamp}</strong>: ${comm.text}`;
        ul.appendChild(li);
      });
    }
    function loadComments() {
      const savedComments = localStorage.getItem("comments");
      if(savedComments) { comments = JSON.parse(savedComments); updateComments(); }
    }
    window.addEventListener("beforeunload", () => { localStorage.setItem("comments", JSON.stringify(comments)); });
    
    /* --- قسم رفع الملفات --- */
    function initFileUpload() {
      const fileInput = document.getElementById("fileInput");
      fileInput.addEventListener("change", (e) => {
        const files = e.target.files;
        const filesDiv = document.getElementById("uploadedFiles");
        filesDiv.innerHTML = "";
        for(let i = 0; i < files.length; i++){
          const file = files[i];
          const p = document.createElement("p");
          p.innerText = "تم رفع: " + file.name;
          filesDiv.appendChild(p);
        }
      });
    }
    
    /* --- قسم إحصائيات المشروع (Line Chart) --- */
    let progressLineChartInstance;
    function initProgressChart() {
      const ctx = document.getElementById('progressLineChart').getContext('2d');
      progressLineChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'نسبة الإنجاز',
            data: [],
            borderColor: 'rgba(46, 204, 113, 1)',
            backgroundColor: 'rgba(46, 204, 113, 0.2)',
            fill: true
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
      });
    }
    function updateProgressChart() {
      if(progressLineChartInstance) {
        const completedTasks = projectTasks.filter(task => task.completed).length;
        const tasksCount = projectTasks.length;
        const progressPercent = tasksCount > 0 ? Math.round((completedTasks / tasksCount) * 100) : 0;
        const now = new Date().toLocaleTimeString();
        progressLineChartInstance.data.labels.push(now);
        progressLineChartInstance.data.datasets[0].data.push(progressPercent);
        progressLineChartInstance.update();
      }
    }
    
    /* --- دوال الجداول الزمنية والمواد (محاكاة) --- */
    let schedule = [];
    let projectTasks = [];
    function addTask() {
      const task = document.getElementById('taskName').value;
      const start = document.getElementById('startDate').value;
      const end = document.getElementById('endDate').value;
      if(task && start && end) {
        schedule.push({ task, start, end });
        updateScheduleTable();
        document.getElementById('taskName').value = "";
        document.getElementById('startDate').value = "";
        document.getElementById('endDate').value = "";
        updateGanttChart();
        updateDashboard();
      } else { alert("يرجى إدخال جميع معطيات المهمة."); }
    }
    function updateScheduleTable() {
      const tbody = document.getElementById('scheduleTable').querySelector('tbody');
      tbody.innerHTML = "";
      schedule.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.task}</td><td>${item.start}</td><td>${item.end}</td>`;
        tbody.appendChild(tr);
      });
      updateGanttChart();
      updateDashboard();
    }
    function loadProjectTasks() {
      const savedTasks = localStorage.getItem('projectTasks');
      if(savedTasks) {
        projectTasks = JSON.parse(savedTasks);
        updateTaskList();
      }
    }
    function addProjectTask() {
      const task = document.getElementById('taskInput').value;
      if(task) {
        projectTasks.push({ task, completed: false });
        updateTaskList();
        document.getElementById('taskInput').value = "";
        updateDashboard();
      } else { alert("يرجى إدخال المهمة."); }
    }
    function updateTaskList() {
      const ul = document.getElementById('taskList');
      if(!ul) return;
      ul.innerHTML = "";
      projectTasks.forEach((item, index) => {
        const li = document.createElement('li');
        li.className = item.completed ? "completed" : "";
        li.innerHTML = `<span>${item.task}</span>
                        <div>
                          <button onclick="toggleTask(${index})">تغيير</button>
                          <button onclick="removeTask(${index})">حذف</button>
                        </div>`;
        ul.appendChild(li);
      });
      localStorage.setItem('projectTasks', JSON.stringify(projectTasks));
      updateDashboard();
    }
    function toggleTask(index) {
      projectTasks[index].completed = !projectTasks[index].completed;
      updateTaskList();
    }
    function removeTask(index) {
      projectTasks.splice(index, 1);
      updateTaskList();
    }
    
    /* --- قسم تصاميم مشابهة --- */
    function populateSimilarDesigns() {
      const similarDesigns = [
        { title: "نموذج 1", description: "تصميم مستوحى من الأنماط الحديثة.", image: "https://via.placeholder.com/400x250?text=نموذج+1" },
        { title: "نموذج 2", description: "تصميم كلاسيكي مع تفاصيل فنية دقيقة.", image: "https://via.placeholder.com/400x250?text=نموذج+2" },
        { title: "نموذج 3", description: "تصميم عملي يراعي الاستخدام الوظيفي.", image: "https://via.placeholder.com/400x250?text=نموذج+3" }
      ];
      let html = "";
      similarDesigns.forEach(design => {
        html += `
          <div class="design-card btn-animate" data-aos="fade-up">
            <div class="card-header">${design.title}</div>
            <div class="card-content">
              <p>${design.description}</p>
            </div>
            <img src="${design.image}" alt="${design.title}" loading="lazy">
          </div>
        `;
      });
      document.getElementById("similarDesignsGrid").innerHTML = html;
    }
    
    /* --- قسم المخطط الزمني (Gantt Chart) --- */
    function initGanttChart() {
      const tasks = schedule.map((item, index) => ({
        id: "Task " + (index+1),
        name: item.task,
        start: item.start,
        end: item.end,
        progress: 50
      }));
      gantt = new Gantt("#ganttChart", tasks, {
        view_mode: 'Day',
        language: currentLanguage === 'ar' ? 'ar' : 'en'
      });
    }
    function updateGanttChart() {
      if(gantt) {
        const tasks = schedule.map((item, index) => ({
          id: "Task " + (index+1),
          name: item.task,
          start: item.start,
          end: item.end,
          progress: 50
        }));
        gantt.refresh(tasks);
      } else { initGanttChart(); }
    }
    
    /* --- قسم إحصائيات المشروع (Line Chart) --- */
    function initProgressChart() {
      const ctx = document.getElementById('progressLineChart').getContext('2d');
      progressLineChartInstance = new Chart(ctx, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'نسبة الإنجاز', data: [], borderColor: 'rgba(46, 204, 113, 1)', backgroundColor: 'rgba(46, 204, 113, 0.2)', fill: true }] },
        options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
      });
    }
    function updateProgressChart() {
      if(progressLineChartInstance) {
        const completedTasks = projectTasks.filter(task => task.completed).length;
        const tasksCount = projectTasks.length;
        const progressPercent = tasksCount > 0 ? Math.round((completedTasks / tasksCount) * 100) : 0;
        const now = new Date().toLocaleTimeString();
        progressLineChartInstance.data.labels.push(now);
        progressLineChartInstance.data.datasets[0].data.push(progressPercent);
        progressLineChartInstance.update();
      }
    }
    
    /* --- قسم تقدير الكميات والتكلفة --- */
    let materials = [];
    function addMaterial() {
      const name = document.getElementById("materialName").value;
      const quantity = parseFloat(document.getElementById("materialQuantity").value) || 0;
      const cost = parseFloat(document.getElementById("materialCost").value) || 0;
      if(name.trim() !== "" && quantity > 0 && cost > 0) {
        const total = quantity * cost;
        materials.push({ name, quantity, cost, total });
        updateMaterialsTable();
        document.getElementById("materialName").value = "";
        document.getElementById("materialQuantity").value = "";
        document.getElementById("materialCost").value = "";
        updateCostChart();
      } else {
        alert("يرجى إدخال بيانات المادة بشكل صحيح.");
      }
    }
    function updateMaterialsTable() {
      const tbody = document.getElementById("materialsTable").querySelector("tbody");
      tbody.innerHTML = "";
      materials.forEach(mat => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${mat.name}</td><td>${mat.quantity}</td><td>${mat.cost}</td><td>${mat.total.toFixed(2)}</td>`;
        tbody.appendChild(tr);
      });
    }
    
    /* --- قسم المخطط الإداري (محاكاة) --- */
    function generateAdminPlan() {
      const tbody = document.getElementById("adminPlanTable").querySelector("tbody");
      tbody.innerHTML = "";
      // محاكاة خطوات إدارة المشروع وفق معايير عالمية
      const phases = [
        { phase: "تخطيط المشروع", description: "تحديد الأهداف وتوزيع المهام.", duration: "1 أسبوع" },
        { phase: "تصميم المشروع", description: "إنشاء المخطط الأولي والنماذج التصميمية.", duration: "2 أسابيع" },
        { phase: "تنفيذ المشروع", description: "بدء التنفيذ والمتابعة.", duration: "3 أسابيع" },
        { phase: "مراجعة المشروع", description: "تقييم الأداء وإجراء التعديلات.", duration: "1 أسبوع" }
      ];
      phases.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${item.phase}</td><td>${item.description}</td><td>${item.duration}</td>`;
        tbody.appendChild(tr);
      });
    }
    
    /* --- عند تحميل الصفحة --- */
    window.addEventListener('load', () => {
      AOS.init();
      document.getElementById('loader').style.display = 'none';
      loadInputs();
      updateCostChart();
      updateLanguageTexts();
      loadSettings();
      if(document.getElementById("floorPlanPreview")){
        Sortable.create(document.getElementById("floorPlanPreview"), { animation: 150 });
      }
      loadProjectTasks();
      populateSimilarDesigns();
      getRandomAIDecision();
      updateDashboard();
      initGanttChart();
      loadComments();
      initFileUpload();
      initProgressChart();
      updateDateTime();
      generateAdminPlan();
    });
    
    /* وظيفة عرض التاريخ والوقت */
    function updateDateTime() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      const timeString = `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')} ${ampm}`;
      const dateString = now.toLocaleDateString();
      document.getElementById("dateTimeDisplay").innerText = dateString + " " + timeString;
    }
    setInterval(updateDateTime, 1000);
  </script>
</body>
</html>
